<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿åˆ†æ Web</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        :root { --base-font-size: 16px; }
        html { font-size: var(--base-font-size); }

        body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif; margin: 0; padding: 0; background: #f2f2f7; color: #333; }
        
        header { background: #fff; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; position: sticky; top: 0; z-index: 100; }
        h1 { margin: 0; font-size: 1.2rem; }
        .version-tag { font-size: 0.7rem; color: #888; font-weight: normal; margin-left: 5px; vertical-align: middle; }

        .settings-btn { background: none; border: 1px solid #ccc; border-radius: 5px; padding: 5px 10px; cursor: pointer; font-size: 0.9rem; color: #555; }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€š */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; justify-content: center; align-items: center; }
        .modal-box { background: #fff; padding: 20px; border-radius: 10px; width: 90%; max-width: 350px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); display: flex; flex-direction: column; max-height: 80vh; }
        
        /* ãƒ˜ãƒ«ãƒ—ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«æ‹¡å¼µ */
        .modal-box.help-box { max-width: 600px; }
        .help-content { overflow-y: auto; text-align: left; margin-bottom: 15px; padding-right: 5px; font-size: 0.9rem; line-height: 1.6; }
        .help-section { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .help-section:last-child { border-bottom: none; }
        .help-title { font-weight: bold; color: #007aff; margin-bottom: 5px; font-size: 1rem; }

        .modal-title { font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; font-size: 1.1rem; text-align: center; }
        .menu-item { margin-bottom: 15px; }
        .menu-label { display: block; font-size: 0.9rem; color: #666; margin-bottom: 5px; }
        .menu-control { width: 100%; padding: 8px; font-size: 1rem; border: 1px solid #ddd; border-radius: 5px; }

        .file-area { padding: 15px; background: #fff; margin-bottom: 10px; text-align: center; }
        .status-box { font-size: 0.9rem; color: #666; margin-top: 8px; min-height: 1.5em; font-weight: bold; }
        .status-success { color: #34c759; }
        .status-loading { color: #007aff; }

        .tabs { display: flex; background: #fff; border-bottom: 1px solid #ccc; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; color: #888; border-bottom: 3px solid transparent; font-size: 0.9rem; }
        .tab.active { color: #007aff; border-bottom: 3px solid #007aff; font-weight: bold; }
        
        .content { display: none; padding: 15px; }
        .content.active { display: block; }
        
        .filter-group { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .filter-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .filter-row:last-child { margin-bottom: 0; }
        select, input[type="text"] { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem; }
        
        .record-list { list-style: none; padding: 0; margin: 0; }
        .record-item { background: #fff; padding: 12px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .record-item:last-child { border-bottom: none; }
        
        .rank-badge { width: 2.2em; height: 2.2em; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px; font-size: 0.9rem; flex-shrink: 0; }
        .rank-1 { background: gold; color: #fff; }
        .rank-2 { background: silver; color: #fff; }
        .rank-3 { background: #cd7f32; color: #fff; }
        .rank-other { background: #eee; color: #333; }
        
        .horse-name { font-weight: bold; font-size: 1.1rem; display: block; }
        .meta-info { font-size: 0.8rem; color: #666; }
        .time-str { font-weight: bold; font-size: 1.2rem; font-family: monospace; }
        .condition { font-size: 0.75rem; color: #999; }
        .outlier { color: red; }
        .ref-text { color: red; font-size: 0.7rem; }
        
        .search-box { display: flex; gap: 5px; }
        .selected-horses-area { background: #fff; padding: 10px; border-radius: 10px; margin-bottom: 15px; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
        .horse-tag { background: #e0f0ff; color: #007aff; padding: 5px 10px; border-radius: 15px; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; border: 1px solid #007aff; }
        .remove-btn { cursor: pointer; font-weight: bold; }
        .btn-compare { width: 100%; padding: 10px; background: #007aff; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; }
        .btn-add { background: none; border: none; color: #007aff; font-size: 1.5rem; cursor: pointer; }
        .check-icon { color: #007aff; font-size: 1.2rem; }
        .hidden { display: none !important; }

        .update-box { text-align: center; padding: 20px; border: 2px dashed #ccc; border-radius: 10px; background: #fafafa; margin-bottom: 20px; }
        .btn-primary { background: #007aff; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 10px; }
        .btn-secondary { background: #8e8e93; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; width: 100%; }
        .btn-danger { background: #ff3b30; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; width: 100%; }
        .btn-help { background: #34c759; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; width: 100%; margin-bottom: 10px; }

        .script-area { text-align: left; margin-bottom: 20px; }
        .code-box { width: 100%; height: 100px; font-family: monospace; font-size: 0.8rem; border: 1px solid #ddd; border-radius: 5px; padding: 5px; background: #f0f0f0; color: #555; box-sizing: border-box; resize: vertical; }
        .btn-copy { background: #5856d6; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-size: 0.9rem; cursor: pointer; margin-right: 5px; }
        .btn-colab { background: #f9ab00; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-size: 0.9rem; cursor: pointer; text-decoration: none; display: inline-block; }
    </style>
</head>
<body>

<header>
    <h1>ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿åˆ†æ <span id="appVersion" class="version-tag">v3.5</span></h1>
    <button class="settings-btn" onclick="toggleMenu()">âš™ï¸ è¨­å®š</button>
</header>

<div id="menuModal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-title">è¨­å®š</div>
        
        <div class="menu-item">
            <button class="btn-help" onclick="toggleHelp()">ğŸ“– ã‚¢ãƒ—ãƒªã®ä½¿ã„æ–¹ã‚’è¦‹ã‚‹</button>
        </div>

        <div class="menu-item">
            <span class="menu-label">æ–‡å­—ã‚µã‚¤ã‚º</span>
            <select id="fontSizeSelect" class="menu-control" onchange="changeFontSize(this.value)">
                <option value="small">å°</option>
                <option value="medium" selected>ä¸­ (æ¨™æº–)</option>
                <option value="large">å¤§</option>
            </select>
        </div>

        <div class="menu-item">
            <span class="menu-label">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</span>
            <button class="btn-danger" onclick="clearDB()">ä¿å­˜æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button>
        </div>

        <button class="btn-secondary" onclick="toggleMenu()">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="helpModal" class="modal-overlay">
    <div class="modal-box help-box">
        <div class="modal-title">ğŸ“– ã‚¢ãƒ—ãƒªã®ä½¿ã„æ–¹</div>
        
        <div class="help-content">
            <div class="help-section">
                <div class="help-title">1. ã¯ã˜ã‚ã«</div>
                åˆå›åˆ©ç”¨æ™‚ã¯ã€ã€Œãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã€ã‹ã‚‰CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚<br>
                ãƒ‡ãƒ¼ã‚¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ä¿å­˜ã•ã‚Œã‚‹ãŸã‚ã€æ¬¡å›ã‹ã‚‰ã¯è‡ªå‹•çš„ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚
            </div>

            <div class="help-section">
                <div class="help-title">2. ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½</div>
                å ´æ‰€ãƒ»ãƒˆãƒ©ãƒƒã‚¯ï¼ˆèŠ/ãƒ€ãƒ¼ãƒˆï¼‰ãƒ»è·é›¢ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒ ã®æ—©ã„é †ã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
                <ul>
                    <li><strong>å¯¾è±¡æœŸé–“:</strong> ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šéƒ¨ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§ã€é›†è¨ˆæœŸé–“ï¼ˆä½•å¹´ã®ä½•æœˆã‹ã‚‰æœ€æ–°ã¾ã§ï¼‰ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</li>
                    <li><strong>å‚è€ƒè¨˜éŒ²è¾¼:</strong> ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨ã€ç•°å¸¸å€¤åˆ¤å®šï¼ˆæ¥µç«¯ã«æ—©ã„/é…ã„ï¼‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚‚è¡¨ç¤ºã—ã¾ã™ã€‚</li>
                </ul>
            </div>

            <div class="help-section">
                <div class="help-title">3. é¦¬æ¤œç´¢ãƒ»æ¯”è¼ƒ</div>
                é¦¬åã®ä¸€éƒ¨ã‚’å…¥åŠ›ã—ã¦æ¤œç´¢ã§ãã¾ã™ã€‚<br>
                æ¤œç´¢çµæœã®ã€Œï¼‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãã®é¦¬ã‚’<strong>ã€Œæ¯”è¼ƒãƒªã‚¹ãƒˆã€</strong>ã«è¿½åŠ ã§ãã¾ã™ã€‚<br>
                è¤‡æ•°ã®é¦¬ã‚’é¸æŠã—ãŸçŠ¶æ…‹ã§ã€Œå±¥æ­´ã‚’æ¯”è¼ƒã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€é¸æŠã—ãŸé¦¬åŒå£«ã®éå»èµ°ã‚’ä¸€è¦§ã§æ¯”è¼ƒã§ãã¾ã™ã€‚
            </div>

            <div class="help-section">
                <div class="help-title">4. ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ãƒ»æ›´æ–°</div>
                æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ï¼ˆç¿Œé€±åˆ†ãªã©ï¼‰ã‚’è¿½åŠ ã—ãŸã„å ´åˆã¯ã€ã€Œãƒ‡ãƒ¼ã‚¿è¿½åŠ ã€ã‚¿ãƒ–ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚<br>
                <ol>
                    <li>Google Colabãªã©ã§æœ€æ–°ã®CSVã‚’å–å¾—ã™ã‚‹ã€‚</li>
                    <li>ã€Œãƒ‡ãƒ¼ã‚¿è¿½åŠ ã€ã‚¿ãƒ–ã§ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ã€‚</li>
                    <li>ã€Œè¿½è¨˜ã—ã¦ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã€‚</li>
                </ol>
                â€»ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šã„å ´åˆã¯ã€PCä¸Šã§çµåˆã—ã¦ã‹ã‚‰å†ç™»éŒ²ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚
            </div>
            
            <div class="help-section">
                <div class="help-title">5. ãã®ä»–</div>
                <ul>
                    <li><strong>æ–‡å­—ã‚µã‚¤ã‚º:</strong> è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰å¤§ãƒ»ä¸­ãƒ»å°ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</li>
                    <li><strong>ãƒ‡ãƒ¼ã‚¿å‰Šé™¤:</strong> å‹•ä½œãŒé‡ã„å ´åˆãªã©ã¯ã€è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚</li>
                </ul>
            </div>
        </div>

        <button class="btn-secondary" onclick="toggleHelp()">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div class="file-area">
    <label for="csvFile" style="font-weight:bold;">ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿</label><br>
    <div style="font-size:0.7rem; color:#888; margin-bottom:5px;">(â€»180MBè¶…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã‚µã‚¯ã‚µã‚¯å‹•ä½œã—ã¾ã™)</div>
    <input type="file" id="csvFile" accept=".csv">
    <div id="fileStatus" class="status-box">ãƒ‡ãƒ¼ã‚¿æœªãƒ­ãƒ¼ãƒ‰</div>

    <div id="periodFilterArea" class="period-area">
        <div style="font-size:0.8rem; font-weight:bold; color:#007aff;">â–¼ å¯¾è±¡æœŸé–“ã®è¨­å®š</div>
        <div class="period-control">
            <select id="startYear" class="period-select" onchange="applyDateFilter()"></select>
            <span>å¹´</span>
            <select id="startMonth" class="period-select" onchange="applyDateFilter()">
                <option value="1">1</option><option value="2">2</option><option value="3">3</option>
                <option value="4">4</option><option value="5">5</option><option value="6">6</option>
                <option value="7">7</option><option value="8">8</option><option value="9">9</option>
                <option value="10">10</option><option value="11">11</option><option value="12">12</option>
            </select>
            <span>æœˆ ã€œ <span id="endDateLabel" style="font-weight:bold; color:#007aff;">æœ€æ–°</span></span>
        </div>
        <div id="periodCount" style="font-size:0.7rem; color:#666; margin-top:5px;"></div>
    </div>
</div>

<div class="tabs">
    <div class="tab active" onclick="switchTab('ranking')">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
    <div class="tab" onclick="switchTab('search')">é¦¬æ¤œç´¢ãƒ»æ¯”è¼ƒ</div>
    <div class="tab" onclick="switchTab('update')">ãƒ‡ãƒ¼ã‚¿è¿½åŠ </div>
</div>

<div id="ranking" class="content active">
    <div class="filter-group">
        <div class="filter-row">
            <select id="placeSelect" onchange="updateRanking()">
                <option value="å…¨ã¦">å ´æ‰€: å…¨ã¦</option>
            </select>
            <select id="trackSelect" onchange="updateRanking()">
            </select>
        </div>
        <div class="filter-row">
            <select id="distSelect" onchange="updateRanking()">
                <option value="1200">1200m</option><option value="1400">1400m</option>
                <option value="1600" selected>1600m</option><option value="1800">1800m</option>
                <option value="2000">2000m</option><option value="2400">2400m</option>
            </select>
            <label style="display:flex; align-items:center; font-size:0.8rem;">
                <input type="checkbox" id="outlierCheck" onchange="updateRanking()" checked> å‚è€ƒè¨˜éŒ²è¾¼
            </label>
        </div>
    </div>
    <div id="rankingList" class="record-list">
        <div style="text-align:center; color:#999; padding:20px;">ãƒ‡ãƒ¼ã‚¿æœªãƒ­ãƒ¼ãƒ‰</div>
    </div>
</div>

<div id="search" class="content">
    <div class="filter-group">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="é¦¬åã‚’å…¥åŠ› (ä¾‹: ãƒ‰ã‚¦ãƒ‡ãƒ¥ãƒ¼ã‚¹)" oninput="searchHorse()">
        </div>
    </div>
    <div class="selected-horses-area" id="selectedArea" style="display:none;">
        <div style="font-size:0.8rem; color:gray; margin-bottom:5px;">é¸æŠä¸­ã®é¦¬</div>
        <div class="tag-container" id="selectedTags"></div>
        <button class="btn-compare" onclick="showComparison()">ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã®å±¥æ­´ã‚’æ¯”è¼ƒ</button>
    </div>
    <div id="searchFilterArea" class="filter-group hidden">
        <div style="font-size:0.8rem; color:#007aff; margin-bottom:8px; font-weight:bold;">â–¼ çµã‚Šè¾¼ã¿æ¡ä»¶</div>
        <div class="filter-row">
            <select id="s_placeSelect" onchange="updateComparison()">
                <option value="å…¨ã¦" selected>å ´æ‰€: å…¨ã¦</option>
            </select>
            <select id="s_trackSelect" onchange="updateComparison()">
                <option value="å…¨ã¦" selected>ãƒˆãƒ©ãƒƒã‚¯: å…¨ã¦</option>
            </select>
        </div>
        <div class="filter-row">
            <select id="s_distSelect" onchange="updateComparison()">
                <option value="å…¨ã¦" selected>è·é›¢: å…¨ã¦</option>
                <option value="1200">1200m</option><option value="1400">1400m</option>
                <option value="1600">1600m</option><option value="1800">1800m</option>
                <option value="2000">2000m</option><option value="2400">2400m</option>
            </select>
            <label style="display:flex; align-items:center; font-size:0.8rem;">
                <input type="checkbox" id="s_outlierCheck" onchange="updateComparison()" checked> å‚è€ƒè¨˜éŒ²è¾¼
            </label>
        </div>
    </div>
    <div id="searchResultTitle" style="margin: 10px 0; font-weight:bold; display:none;">æ¤œç´¢çµæœ</div>
    <div id="searchList" class="record-list"></div>
</div>

<div id="update" class="content">
    <div class="filter-group">
        <h3 style="margin-top:0;">1. æ–°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—</h3>
        <p style="font-size:0.9rem; color:#666;">
            Google Colabã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã€CSV(ä¾‹: new_data.csv)ã‚’å–å¾—ã—ã¾ã™ã€‚
        </p>
        <div class="script-area">
            <textarea id="pythonCode" class="code-box" readonly></textarea>
            <div style="margin-top:5px; text-align:center;">
                <button class="btn-copy" onclick="copyScript()">ğŸ“‹ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
                <a href="https://colab.research.google.com/" target="_blank" class="btn-colab">ğŸš€ Colabã‚’é–‹ã</a>
            </div>
        </div>
    </div>
    <div class="filter-group">
        <h3 style="margin-top:0;">2. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã«è¿½è¨˜</h3>
        <p style="font-size:0.9rem; color:#666;">
            æ–°ã—ãå–å¾—ã—ãŸCSVã‚’é¸æŠã—ã€ã€Œã‚¢ãƒ—ãƒªå†…ã«ä¿å­˜ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<br>
            <span style="color:#007aff; font-weight:bold;">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸è¦ã§ã€ãã®ã¾ã¾ä½¿ãˆã¾ã™ã€‚</span>
        </p>
        <div class="update-box">
            <label style="display:block; margin-bottom:10px; font-weight:bold;">è¿½åŠ ã™ã‚‹CSV (new_data.csv)</label>
            <input type="file" id="updateFile" accept=".csv">
        </div>
        <div id="updateResult" style="margin-bottom:20px; font-weight:bold; color:#007aff;"></div>
        <div id="mergeActionArea" class="hidden">
            <button id="saveInternalBtn" class="btn-primary" onclick="saveMergedToDB()">
                ğŸ’¾ è¿½è¨˜ã—ã¦ã‚¢ãƒ—ãƒªå†…ã«ä¿å­˜<br>
            </button>
            <div style="margin-top:15px; border-top:1px solid #eee; padding-top:15px;">
                <button id="downloadBtn" class="btn-secondary" onclick="downloadMergedCSV()">
                    CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æ›¸ãå‡ºã—
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- ãƒ¡ãƒ¢ãƒªæœ€é©åŒ– & å‹•çš„ãƒãƒƒãƒ”ãƒ³ã‚° ---
    const DB = {
        ids: [], dates: [], places: [], tracks: [], dists: [], 
        conditions: [], ranks: [], names: [], times: [], time_strs: [], outliers: [],
        validIndices: []
    };

    const Dicts = {
        place: { list: ["ãã®ä»–"], map: {"ãã®ä»–":0} },
        track: { list: ["èŠ"],     map: {"èŠ":0} },
        cond:  { list: ["-"],      map: {"-":0} }
    };

    let selectedHorses = new Set();
    let isComparisonMode = false;
    
    // DBé–¢é€£
    const IDB_NAME = 'KeibaAppDB';
    const IDB_VER = 2;
    const STORE_NAME = 'csvStore';
    let db;
    let mergedContentBlob = null; 

    // --- Colab Script ---
    const pythonScriptContent = `# Google Colabç”¨ ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# ========== ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ==========
# ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã«ã€å¿…è¦ãªæ©Ÿèƒ½ã‚’å¼·åˆ¶çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™
!pip install pandas requests beautifulsoup4

# ========== ã“ã“ã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ æœ¬ä½“ ==========
import requests
from bs4 import BeautifulSoup
import pandas as pd
import time
import re
import random
from google.colab import files

# ========== è¨­å®šã‚¨ãƒªã‚¢ (ã“ã“ã‚’å¤‰æ›´) ==========
TARGET_YEAR = 2025  # å–å¾—ã—ãŸã„å¹´
TARGET_MONTH = 2    # å–å¾—ã—ãŸã„æœˆ (ä¾‹: 2æœˆãªã‚‰ 2)
# ==========================================

USER_AGENTS = [
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36"
]

def get_html(url):
    try:
        headers = {"User-Agent": random.choice(USER_AGENTS)}
        res = requests.get(url, headers=headers, timeout=30)
        res.encoding = "euc-jp"
        return BeautifulSoup(res.text, "html.parser")
    except: return None

def get_race_ids(year, month):
    race_ids = []
    page = 1
    while True:
        # é€²è¡ŒçŠ¶æ³ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«printã‚’è¿½åŠ 
        print(f"ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ãƒšãƒ¼ã‚¸ {page} ã‚’å–å¾—ä¸­...")
        url = f"https://db.netkeiba.com/?pid=race_list&word=&start_year={year}&start_mon={month}&end_year={year}&end_mon={month}&sort=date&list=100&page={page}"
        soup = get_html(url)
        if not soup: break
        table = soup.find("table", class_="race_table_01")
        if not table: break
        rows = table.find_all("tr")
        if len(rows) <= 1: break
        current_ids = []
        for row in rows[1:]:
            a = row.find("a", href=re.compile(r"/race/\d+"))
            if a:
                match = re.search(r"/race/(\d+)", a["href"])
                if match: current_ids.append(match.group(1))
        if not current_ids: break
        race_ids.extend(current_ids)
        page += 1
        time.sleep(1)
    return race_ids

def get_race_details(race_id):
    url = f"https://db.netkeiba.com/race/{race_id}/"
    soup = get_html(url)
    if not soup: return []
    intro = soup.find("div", class_="data_intro")
    date_str, place, track, dist, cond = "", "ãã®ä»–", "èŠ", 1600, "è‰¯"
    if intro:
        txt = intro.get_text()
        d_m = re.search(r"(\d+å¹´\d+æœˆ\d+æ—¥)", txt)
        if d_m: date_str = d_m.group(1)
        if "ãƒ€" in txt: track = "ãƒ€ãƒ¼ãƒˆ"
        elif "éšœ" in txt: track = "éšœå®³"
        dist_m = re.search(r"(\d+)m", txt)
        if dist_m: dist = int(dist_m.group(1))
        p_code = race_id[4:6]
        places = {"05":"æ±äº¬","06":"ä¸­å±±","08":"äº¬éƒ½","09":"é˜ªç¥"}
        place = places.get(p_code, "ãã®ä»–")
        if "ç¨" in txt: cond = "ç¨é‡"
        elif "é‡" in txt: cond = "é‡"
        elif "ä¸" in txt: cond = "ä¸è‰¯"
    table = soup.find("table", class_="race_table_01")
    if not table: return []
    rows = table.find_all("tr")
    headers = [th.get_text().strip() for th in rows[0].find_all("th")]
    try:
        i_rank = headers.index("ç€é †")
        i_name = headers.index("é¦¬å")
        i_time = headers.index("ã‚¿ã‚¤ãƒ ")
        i_w = headers.index("æ–¤é‡")
    except: return []
    records = []
    for row in rows[1:]:
        cols = row.find_all("td")
        if len(cols) != len(headers): continue
        try:
            r_str = cols[i_rank].get_text().strip()
            if not r_str.isdigit(): continue
            rank = int(r_str)
            name = cols[i_name].get_text().strip()
            t_str = cols[i_time].get_text().strip()
            sec = 0.0
            if ":" in t_str:
                p = t_str.split(":")
                sec = float(p[0])*60 + float(p[1])
            w = float(cols[i_w].get_text().strip())
            records.append({
                "race_id": race_id, "date": date_str, "place": place, "track": track,
                "distance": dist, "condition": cond, "rank": rank, "horse_name": name,
                "time_str": t_str, "seconds": round(sec, 1), "weight": w, "age_sex": "",
                "is_abnormal_type": False, "is_statistical_outlier": False, "is_outlier": False
            })
        except: continue
    return records

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
print(f"{TARGET_YEAR}å¹´{TARGET_MONTH}æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™...")
r_ids = get_race_ids(TARGET_YEAR, TARGET_MONTH)
print(f"å¯¾è±¡ãƒ¬ãƒ¼ã‚¹æ•°: {len(r_ids)}ä»¶")

all_data = []
for i, rid in enumerate(r_ids):
    data = get_race_details(rid)
    if data: all_data.extend(data)
    time.sleep(1) # ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›ã®ãŸã‚ã®å¾…æ©Ÿ
    if i % 10 == 0: print(f"é€²æ—: {i}/{len(r_ids)} ãƒ¬ãƒ¼ã‚¹å®Œäº†")

if all_data:
    df = pd.DataFrame(all_data)
    filename = f"new_data_{TARGET_YEAR}_{TARGET_MONTH}.csv"
    df.to_csv(filename, index=False, encoding="utf-8-sig")
    print(f"å®Œäº†ï¼ '{filename}' ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™...")
    files.download(filename)
else:
    print("ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")
`;

    window.onload = function() {
        openDB();
        document.getElementById('pythonCode').value = pythonScriptContent;
        const savedSize = localStorage.getItem('keiba_font_size') || 'medium';
        document.getElementById('fontSizeSelect').value = savedSize;
        changeFontSize(savedSize);
    };

    function copyScript() {
        const c = document.getElementById("pythonCode"); c.select();
        navigator.clipboard.writeText(c.value).then(()=>alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
    }

    // --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ãƒ˜ãƒ«ãƒ—æ“ä½œ ---
    function toggleMenu() {
        const m = document.getElementById('menuModal');
        m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
    }
    
    function toggleHelp() {
        const h = document.getElementById('helpModal');
        h.style.display = (h.style.display === 'flex') ? 'none' : 'flex';
        // ãƒ˜ãƒ«ãƒ—ã‚’é–‹ãã¨ãã¯è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
        if(h.style.display === 'flex') {
            document.getElementById('menuModal').style.display = 'none';
        }
    }

    function changeFontSize(size) {
        let pxVal = '16px';
        if (size === 'small') pxVal = '13px';
        if (size === 'large') pxVal = '20px';
        document.documentElement.style.setProperty('--base-font-size', pxVal);
        localStorage.setItem('keiba_font_size', size);
    }

    // --- Helper: å‹•çš„IDç®¡ç† ---
    function getDictId(type, val) {
        val = (val || "").trim();
        if(!val) return 0; 
        const dic = Dicts[type];
        if(dic.map.hasOwnProperty(val)) return dic.map[val];
        const idx = dic.list.length;
        dic.list.push(val);
        dic.map[val] = idx;
        return idx;
    }

    // --- IndexedDB ---
    function openDB() {
        const req = indexedDB.open(IDB_NAME, IDB_VER);
        req.onupgradeneeded = function(e) {
            db = e.target.result;
            if (db.objectStoreNames.contains(STORE_NAME)) db.deleteObjectStore(STORE_NAME);
            db.createObjectStore(STORE_NAME, { keyPath: 'id' });
        };
        req.onsuccess = function(e) {
            db = e.target.result;
            loadFromDB();
        };
        req.onerror = function() { console.error("DB Error"); };
    }

    function saveToDB(fileOrBlob, fileName, callback) {
        if (!db) return;
        const tx = db.transaction([STORE_NAME], 'readwrite');
        const store = tx.objectStore(STORE_NAME);
        const data = { id: 'mainCSV', content: fileOrBlob, fileName: fileName, date: new Date().toLocaleString() };
        const req = store.put(data);
        req.onsuccess = function() {
            document.getElementById('fileStatus').innerHTML = `<span class="status-success">ä¿å­˜å®Œäº† (${data.date})</span>`;
            if(callback) callback();
        };
        req.onerror = function(e) { alert("ä¿å­˜å¤±æ•—: " + e.target.error.message); };
    }

    function loadFromDB() {
        const tx = db.transaction([STORE_NAME], 'readonly');
        const store = tx.objectStore(STORE_NAME);
        store.get('mainCSV').onsuccess = function(e) {
            const res = e.target.result;
            if (res) {
                document.getElementById('fileStatus').innerHTML = `<span class="status-loading">å±•é–‹ä¸­...</span>`;
                setTimeout(() => {
                    loadCSV(res.content, false);
                    document.getElementById('fileStatus').innerHTML = `<span class="status-success">å¾©å…ƒå®Œäº† (${res.date})</span>`;
                    document.getElementById('clearDataArea').classList.remove('hidden'); // hiddenå‰Šé™¤ã—ã¦å¿µã®ãŸã‚
                }, 100);
            } else {
                document.getElementById('fileStatus').innerText = "ãƒ‡ãƒ¼ã‚¿æœªãƒ­ãƒ¼ãƒ‰";
            }
        };
    }

    function clearDB() {
        if(!confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        const tx = db.transaction([STORE_NAME], 'readwrite');
        tx.objectStore(STORE_NAME).delete('mainCSV');
        location.reload();
    }

    // --- CSV Load ---
    document.getElementById('csvFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if(!file) return;
        loadCSV(file, true);
    });

    function loadCSV(file, shouldSave) {
        // ãƒªã‚»ãƒƒãƒˆ
        DB.ids=[]; DB.dates=[]; DB.places=[]; DB.tracks=[]; DB.dists=[]; 
        DB.conditions=[]; DB.ranks=[]; DB.names=[]; DB.times=[]; DB.time_strs=[]; DB.outliers=[];
        DB.validIndices=[];
        Dicts.place={list:["ãã®ä»–"],map:{"ãã®ä»–":0}};
        Dicts.track={list:["èŠ"],map:{"èŠ":0}};
        Dicts.cond={list:["-"],map:{"-":0}};

        let minYear = 9999, maxYear = 0;
        let maxDateVal = 0; 

        document.getElementById('fileStatus').innerHTML = '<span class="status-loading">è§£æä¸­...</span>';

        Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            step: function(row) {
                const r = row.data;
                if (!r.race_id) return;

                DB.ids.push(r.race_id);
                DB.names.push(r.horse_name || "");
                DB.time_strs.push(r.time_str || "");
                
                DB.places.push(getDictId("place", r.place));
                DB.tracks.push(getDictId("track", r.track));
                DB.conditions.push(getDictId("cond", r.condition));

                DB.dists.push(parseInt(r.distance) || 0);
                DB.ranks.push(parseInt(r.rank) || 0);
                DB.times.push(parseFloat(r.seconds) || 9999);
                
                const isOut = (r.is_outlier === 'True' || r.is_outlier === 'true') ? 1 : 0;
                DB.outliers.push(isOut);

                let y = 0, m = 0, d = 0;
                if(r.date) {
                    const mRes = r.date.match(/(\d+)å¹´(\d+)æœˆ(\d+)æ—¥/);
                    if(mRes) {
                        y = parseInt(mRes[1]); m = parseInt(mRes[2]); d = parseInt(mRes[3]);
                        if(y < minYear) minYear = y;
                        if(y > maxYear) maxYear = y;
                    }
                }
                const dateInt = y * 10000 + m * 100 + d;
                if(dateInt > maxDateVal) maxDateVal = dateInt;
                DB.dates.push(dateInt);
            },
            complete: function() {
                if (shouldSave) {
                    const blob = (file instanceof File || file instanceof Blob) ? file : new Blob([file], {type:'text/csv'});
                    saveToDB(blob, file.name || "data.csv");
                }
                updateSelectOptions(); 
                setupDateFilter(minYear, maxYear, maxDateVal);
                applyDateFilter(true);
            },
            error: function(err) { alert("ã‚¨ãƒ©ãƒ¼: " + err.message); }
        });
    }

    function updateSelectOptions() {
        const updateSel = (id, list) => {
            const el = document.getElementById(id);
            el.innerHTML = '<option value="-1">å…¨ã¦</option>';
            list.forEach((val, i) => {
                if(val === "-") return;
                const opt = document.createElement('option');
                opt.value = i; opt.innerText = val; el.appendChild(opt);
            });
        };
        updateSel('placeSelect', Dicts.place.list);
        updateSel('trackSelect', Dicts.track.list);
        
        const updateSelS = (id, list) => {
            const el = document.getElementById(id);
            el.innerHTML = '<option value="-1">å…¨ã¦</option>';
            list.forEach((val, i) => {
                if(val === "-") return;
                const opt = document.createElement('option');
                opt.value = i; opt.innerText = val; el.appendChild(opt);
            });
        };
        updateSelS('s_placeSelect', Dicts.place.list);
        updateSelS('s_trackSelect', Dicts.track.list);
    }

    function setupDateFilter(minYear, maxYear, maxDateVal) {
        if(minYear > 2100) { minYear = 2020; maxYear = 2025; }
        const sel = document.getElementById('startYear');
        sel.innerHTML = '';
        for(let y=minYear; y<=maxYear; y++) {
            const opt = document.createElement('option');
            opt.value = y; opt.innerText = y; sel.appendChild(opt);
        }
        sel.value = minYear;
        document.getElementById('startMonth').value = 1;
        document.getElementById('periodFilterArea').classList.add('visible');

        const endLabel = document.getElementById('endDateLabel');
        if(maxDateVal > 0) {
            const y = Math.floor(maxDateVal / 10000);
            const m = Math.floor((maxDateVal % 10000) / 100);
            const d = maxDateVal % 100;
            endLabel.innerText = `${y}å¹´${m}æœˆ${d}æ—¥`;
        } else {
            endLabel.innerText = "æœ€æ–°";
        }
    }

    function applyDateFilter(refreshUI = true) {
        const sYear = parseInt(document.getElementById('startYear').value);
        const sMonth = parseInt(document.getElementById('startMonth').value);
        const startVal = sYear * 10000 + sMonth * 100 + 1; 

        DB.validIndices = [];
        const len = DB.dates.length;
        for(let i=0; i<len; i++) {
            if (DB.dates[i] >= startVal) DB.validIndices.push(i);
        }
        document.getElementById('periodCount').innerText = `å¯¾è±¡: ${DB.validIndices.length} / ${len}ä»¶`;
        if(refreshUI) {
            updateRanking();
            if(!isComparisonMode) searchHorse(); else updateComparison();
        }
    }

    function updateRanking() {
        if (DB.validIndices.length === 0) {
            document.getElementById('rankingList').innerHTML = '<div style="text-align:center;padding:20px;">ãƒ‡ãƒ¼ã‚¿ãªã—</div>';
            return;
        }
        const pFilter = parseInt(document.getElementById('placeSelect').value);
        const tFilter = parseInt(document.getElementById('trackSelect').value);
        const dFilter = parseInt(document.getElementById('distSelect').value);
        const showOutlier = document.getElementById('outlierCheck').checked;

        let matched = [];
        const indices = DB.validIndices;
        for(let k=0; k<indices.length; k++) {
            const i = indices[k];
            if (pFilter !== -1 && DB.places[i] !== pFilter) continue;
            if (tFilter !== -1 && DB.tracks[i] !== tFilter) continue;
            if (DB.dists[i] !== dFilter) continue;
            if (!showOutlier && DB.outliers[i] === 1) continue;
            matched.push(i);
        }
        matched.sort((a, b) => DB.times[a] - DB.times[b]);
        renderList(matched.slice(0, 100), 'rankingList', true);
    }

    function searchHorse() {
        isComparisonMode = false;
        document.getElementById('searchFilterArea').classList.add('hidden');
        document.getElementById('searchResultTitle').style.display = 'block';
        
        const query = document.getElementById('searchInput').value;
        if (!query) { document.getElementById('searchList').innerHTML = ''; return; }

        const hits = new Set();
        const indices = DB.validIndices;
        for(let k=0; k<indices.length; k++) {
            const i = indices[k];
            const name = DB.names[i];
            if (name.includes(query)) hits.add(name);
        }
        const hitNames = Array.from(hits).sort();

        const c = document.getElementById('searchList');
        c.innerHTML = '';
        hitNames.forEach(name => {
            const div = document.createElement('div');
            div.className = 'record-item'; div.style.cursor = 'pointer';
            const isSel = selectedHorses.has(name);
            div.innerHTML = `<span class="horse-name">${name}</span> ${isSel ? 'âœ”' : 'ï¼‹'}`;
            div.onclick = () => toggleSelectHorse(name);
            c.appendChild(div);
        });
    }

    function toggleSelectHorse(name) {
        if (selectedHorses.has(name)) selectedHorses.delete(name); else selectedHorses.add(name);
        updateSelectedArea();
        if(!isComparisonMode) searchHorse(); else updateComparison();
    }

    function updateSelectedArea() {
        const c = document.getElementById('selectedTags');
        const a = document.getElementById('selectedArea');
        if(selectedHorses.size === 0) { a.style.display='none'; return; }
        a.style.display='block'; c.innerHTML='';
        selectedHorses.forEach(n => {
            const t = document.createElement('div'); t.className='horse-tag';
            t.innerHTML = `${n} <span class="remove-btn" onclick="toggleSelectHorse('${n}')">Ã—</span>`;
            c.appendChild(t);
        });
    }

    function showComparison() {
        isComparisonMode = true;
        document.getElementById('searchFilterArea').classList.remove('hidden');
        updateComparison();
    }

    function updateComparison() {
        if(!isComparisonMode) return;
        const pFilter = parseInt(document.getElementById('s_placeSelect').value);
        const tFilter = parseInt(document.getElementById('s_trackSelect').value);
        const dVal = document.getElementById('s_distSelect').value;
        const dFilter = (dVal === 'å…¨ã¦') ? -1 : parseInt(dVal);
        const showOutlier = document.getElementById('s_outlierCheck').checked;

        let matched = [];
        const indices = DB.validIndices;
        for(let k=0; k<indices.length; k++) {
            const i = indices[k];
            if (!selectedHorses.has(DB.names[i])) continue;
            if (pFilter !== -1 && DB.places[i] !== pFilter) continue;
            if (tFilter !== -1 && DB.tracks[i] !== tFilter) continue;
            if (dFilter !== -1 && DB.dists[i] !== dFilter) continue;
            if (!showOutlier && DB.outliers[i] === 1) continue;
            matched.push(i);
        }
        matched.sort((a, b) => DB.times[a] - DB.times[b]);
        renderList(matched, 'searchList', false);
    }

    function renderList(indices, targetId, isRank) {
        const c = document.getElementById(targetId); c.innerHTML = '';
        if (indices.length === 0) { c.innerHTML = '<div style="text-align:center;padding:20px;">è©²å½“ãªã—</div>'; return; }
        
        indices.forEach((idx, i) => {
            const dateInt = DB.dates[idx];
            const y = Math.floor(dateInt/10000);
            const m = Math.floor((dateInt%10000)/100);
            const d = dateInt%100;
            const dateStr = `${y}å¹´${m}æœˆ${d}æ—¥`;
            
            const placeStr = Dicts.place.list[DB.places[idx]];
            const trackStr = Dicts.track.list[DB.tracks[idx]];
            const condStr = Dicts.cond.list[DB.conditions[idx]];
            
            const isOut = (DB.outliers[idx] === 1);

            const div = document.createElement('div');
            div.className = 'record-item';
            let rh = '';
            if (isRank) {
                let rc = 'rank-other';
                if (i===0) rc='rank-1'; else if(i===1) rc='rank-2'; else if(i===2) rc='rank-3';
                rh = `<div class="rank-badge ${rc}">${i+1}</div>`;
            }
            div.innerHTML = `
                <div style="display:flex;align-items:center;">
                    ${rh}
                    <div><span class="horse-name">${DB.names[idx]}</span>
                    <div class="meta-info">${dateStr} (${placeStr}) <b>${trackStr}${DB.dists[idx]}m</b></div></div>
                </div>
                <div style="text-align:right;">
                    <div class="time-str ${isOut?'outlier':''}">${DB.time_strs[idx]}</div>
                    <div class="condition">${condStr}/${DB.ranks[idx]}ç€</div>
                </div>`;
            c.appendChild(div);
        });
    }

    // --- Merge ---
    document.getElementById('updateFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if(!file) return;
        mergedContentBlob = file; 
        document.getElementById('updateResult').innerHTML = "æº–å‚™OK (â€»æ—¢å­˜ãƒ‡ãƒ¼ã‚¿æœ«å°¾ã«è¿½åŠ ã•ã‚Œã¾ã™)";
        document.getElementById('mergeActionArea').classList.remove('hidden');
    });

    function saveMergedToDB() {
        if(!mergedContentBlob) return;
        const tx = db.transaction([STORE_NAME], 'readwrite');
        const store = tx.objectStore(STORE_NAME);
        store.get('mainCSV').onsuccess = function(e) {
            const oldData = e.target.result;
            let newBlob;
            if (oldData && oldData.content) {
                newBlob = new Blob([oldData.content, "\n", mergedContentBlob], {type: 'text/csv'});
            } else { newBlob = mergedContentBlob; }
            
            const data = { id: 'mainCSV', content: newBlob, fileName: "merged.csv", date: new Date().toLocaleString() };
            store.put(data).onsuccess = function() {
                alert("ä¿å­˜ã—ã¾ã—ãŸã€‚ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦åæ˜ ã—ã¾ã™ã€‚");
                location.reload();
            };
        };
    }

    function downloadMergedCSV() {
        if(!db) return;
        const tx = db.transaction([STORE_NAME], 'readonly');
        tx.objectStore(STORE_NAME).get('mainCSV').onsuccess = function(e) {
            const res = e.target.result;
            if(res && res.content) {
                const url = URL.createObjectURL(res.content);
                const a = document.createElement("a");
                a.href = url; a.download = "app_data_full.csv";
                document.body.appendChild(a); a.click(); document.body.removeChild(a);
            } else { alert("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"); }
        };
    }

    function switchTab(n) {
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
        document.getElementById(n).classList.add('active');
        if(n==='ranking') document.querySelectorAll('.tab')[0].classList.add('active');
        else if(n==='search') document.querySelectorAll('.tab')[1].classList.add('active');
        else document.querySelectorAll('.tab')[2].classList.add('active');
    }
</script>
</body>
</html>